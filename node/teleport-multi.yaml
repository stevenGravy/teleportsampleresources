
#
# Teleport database agent configuration file.
# Configuration reference: https://goteleport.com/docs/reference/agent-services/database-access-reference/configuration/
#
version: v3
teleport:
  data_dir: "/var/lib/teleport"
  proxy_server: "TELEPORT_CLUSTER_PROXY"
  auth_token: "/tmp/token"

app_service:
  enabled: true
  apps:
  - name: "grafana-dev"
    uri: "http://grafana-dev:3000"
    labels:
      env: dev
  - name: "grafana-prod"
    uri: "http://grafana-prod:3000"
    labels:
      env: prod

db_service:
  enabled: true

  # Matchers for database resources created with "tctl create" command or by the discovery service.
  # For more information about dynamic registration: https://goteleport.com/docs/enroll-resources/database-access/guides/dynamic-registration/
  #
  # resources:
  # - labels:
  #     "env": "dev"
  #   # Optional AWS role that the Database Service will assume to access the
  #   # databases.
  #   aws:
  #     assume_role_arn: "arn:aws:iam::123456789012:role/example-role-name"
  #     external_id: "example-external-id"

  # Matchers for registering AWS-hosted databases.
  # For more information about AWS auto-discovery:
  # https://goteleport.com/docs/enroll-resources/auto-discovery/databases/aws/
  #
  # aws:
  #   # Database types. Valid options are:
  #   # 'rds' - discovers and registers AWS RDS and Aurora databases
  #   # 'rdsproxy' - discovers and registers AWS RDS Proxy databases.
  #   # 'redshift' - discovers and registers AWS Redshift databases.
  #   # 'redshift-serverless' - discovers and registers AWS Redshift Serverless databases.
  #   # 'elasticache' - discovers and registers AWS ElastiCache Redis databases.
  #   # 'memorydb' - discovers and registers AWS MemoryDB Redis databases.
  #   # 'opensearch' - discovers and registers AWS OpenSearch domains.
  # - types: ["rds", "rdsproxy", "redshift", "redshift-serverless", "elasticache", "memorydb", "opensearch"]
  #   # AWS regions to register databases from.
  #   regions: ["us-west-1", "us-east-2"]
  #   # AWS resource tags to match when registering databases.
  #   tags:
  #     "*": "*"

  # Matchers for registering Azure-hosted databases.
  # For more information about Azure auto-discovery:
  # MySQL/PostgreSQL: https://goteleport.com/docs/enroll-resources/database-access/enroll-azure-databases/azure-postgres-mysql/
  # Redis: https://goteleport.com/docs/enroll-resources/database-access/enroll-azure-databases/azure-redis/
  # SQL Server: https://goteleport.com/docs/enroll-resources/database-access/enroll-azure-databases/azure-sql-server-ad/
  #
  # azure:
  #   # Database types. Valid options are:
  #   # 'mysql' - discovers and registers Azure MySQL databases.
  #   # 'postgres' - discovers and registers Azure PostgreSQL databases.
  #   # 'redis' - discovers and registers Azure Cache for Redis databases.
  #   # 'sqlserver' - discovers and registers Azure SQL Server databases.
  # - types: ["mysql", "postgres", "redis", "sqlserver"]
  #   # Azure regions to register databases from. Valid options are:
  #   # '*' - discovers databases in all regions (default).
  #   regions: ["eastus", "westus"]
  #   # Azure subscription IDs to register databases from. Valid options are:
  #   # '*' - discovers databases in all subscriptions (default).
  #   subscriptions: ["11111111-2222-3333-4444-555555555555"]
  #   # Azure resource groups to register databases from. Valid options are:
  #   # '*' - discovers databases in all resource groups within configured subscription(s) (default).
  #   resource_groups: ["group1", "group2"]
  #   # Azure resource tags to match when registering databases.
  #   tags:
  #     "*": "*"

  # Lists statically registered databases proxied by this agent.
  databases:
  - name: "postgresdev"
    protocol: "postgres"
    uri: "postgresdev:5432"
    static_labels:
      "env": "dev"
  - name: "postgresprod"
    protocol: "postgres"
    uri: "postgresprod:5432"
    static_labels:
      "env": "prod"

auth_service:
  enabled: "no"
ssh_service:
  enabled: "no"
proxy_service:
  enabled: "no"
